{% extends 'base.html' %}
{% load static %}
{% load rupiah %}

{% block title %}
  Menu Kopi
{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/menu.css' %}" />
{% endblock %}

{% block content %}
  <div class="container py-4">
    <div class="judul-menu">
      <i class="fas fa-mug-hot"></i>
      Temukan Kopi Favoritmu
    </div>

    <!-- Tombol Kategori -->
    <div class="d-flex justify-content-center mb-4 gap-3">
      <a href="{% url 'menu' %}?kategori=all" class="btn {% if not kategori_aktif or kategori_aktif == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">Semua</a>
      <a href="?kategori=coffee" class="btn {% if kategori_aktif == 'coffee' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">Coffee</a>
      <a href="?kategori=non-coffee" class="btn {% if kategori_aktif == 'non-coffee' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">Non Coffee</a>
      <a href="?kategori=snack" class="btn {% if kategori_aktif == 'snack' %}btn-primary{% else %}btn-outline-primary{% endif %} btn-sm">Snack</a>
    </div>

    <!-- Semua menu dikelompokkan per kategori -->
    {% regroup menus by kategori.nama as grouped_menus %}

    <!-- Section Semua -->
    <div id="all">
      <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for item in menus %}
          <div class="col">
            <div class="card h-100 shadow-sm">
              {% if item.gambar %}
                <img src="{{ item.gambar.url }}" class="card-img-top" alt="{{ item.nama }}" />
              {% else %}
                <img src="{% static 'images/default_coffee.jpg' %}" class="card-img-top" alt="Default Coffee" />
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ item.nama }}</h5>
                <p class="card-text">{{ item.deskripsi|truncatewords:15 }}</p>
                <small class="text-muted">Kategori: {{ item.kategori|title }}</small>
              </div>
              <div class="card-footer text-end">
                <strong>{{ item.harga|rupiah }}</strong>
              </div>
            </div>
          </div>
        {% empty %}
          <p class="info-box">Belum ada menu tersedia.</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Scroll script -->
  <script>
    document.querySelectorAll('.btn-kategori').forEach((button) => {
      button.addEventListener('click', () => {
        // Ganti style tombol aktif
        document.querySelectorAll('.btn-kategori').forEach((btn) => {
          btn.classList.remove('btn-primary')
          btn.classList.add('btn-outline-primary')
        })
        button.classList.add('btn-primary')
        button.classList.remove('btn-outline-primary')
    
        const targetId = button.getAttribute('data-target')
        if (targetId === 'all') {
          window.scrollTo({ top: 0, behavior: 'smooth' })
        } else {
          const targetSection = document.getElementById(targetId)
          if (targetSection) {
            targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' })
          }
        }
      })
    })
  </script>
{% endblock %}